#!/bin/sh

# ZSH aliases for system utility functions

alias cat="/usr/share/ccat/ccat -G String='darkgreen' -G Plaintext='blue' -G Comment='darkyellow' -G HTMLTag='purple' -G Literal='darkred' -G Tag='Fuscia'"
alias ls="colorls"
alias xclip="xclip -selection c"

# Print alias function
aprint() {
  for file in ${HOME}/.aliases/.*; do
    str=$(cat ${file} | grep -Poz "(?s)(?<=$1\(\) {\n).*?(?=\n})" | sed -E 's/^[ ]{2}//g')
    if [[ ! -z ${str} ]]; then
        echo -E ${str}
        return
    fi

    str=$(cat ${file} | grep -Po "(?<=$1=\").[^\"]*")
    if [[ ! -z ${str} ]]; then
        echo -E ${str}
        return
    fi
  done
}

# print last errno
eno() {
  _e=$(($(echo $?)))
  [ ${_e} -ne 0 ] && { [ ${_e} -le 134 ] && errno ${_e} || echo "${_e} Unknown error" } || true
}

# update system
update() {
  sudo apt update -y && sudo apt upgrade -y && sudo apt autoremove -y && sudo apt autoclean -y
  cd ${HOME}/.dotfiles && [ "$(parse_git_dirty)" = "$ZSH_THEME_GIT_PROMPT_CLEAN" ] &&
  { git pull; ln -f sublime/* ${HOME}/.config/sublime*/Packages/User;
    ln -f zsh/.zshrc ${HOME}; ln -f zsh/.aliases/.* ${HOME}/.aliases;
    ln -f .private-configs/* ${HOME}/.private-configs } ||
  echo "Uncommitted changes found";
  cd -
}
